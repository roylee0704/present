## แผนการตรวจสอบและเช็กลิสต์ (AUDIT PLAN AND CHECKLIST)

อ้างอิง: `docs/quotation.md`

### วัตถุประสงค์ (Purpose)
กำหนดแนวทางการตรวจสอบ (audit approach), ขอบเขต, เกณฑ์การยอมรับ, หลักฐานที่ต้องใช้ และรายงาน สำหรับด้านความปลอดภัย (Security), การปฏิบัติตามกฎหมาย (Compliance), ประสิทธิภาพ (Performance) และบันทึกการตรวจสอบ (Audit Trail) ให้สอดคล้องกับโครงการระบบจัดการการประชุมของภาครัฐ

### เป้าหมาย (Objectives)
- ตรวจสอบท่าทีด้านความปลอดภัย (security posture) และลดความเสี่ยงเชิงรุก
- แสดงให้เห็นถึงการปฏิบัติตามกฎหมาย (PDPA, ETA, พระราชบัญญัติความมั่นคงปลอดภัยไซเบอร์)
- ยืนยันว่าประสิทธิภาพระบบเป็นไปตาม SLO ของผู้ใช้ (โหลดเอกสาร <3 วินาที; ลายเซ็น <1 วินาที)
- ทำให้มั่นใจว่ามีบันทึกตรวจสอบที่ป้องกันการแก้ไข (tamper-evident) สำหรับการกระทำสำคัญ (การอนุมัติ, การลงลายเซ็น)

### ระบบที่อยู่ในขอบเขต (In-Scope Systems)
- แอป Flutter บนแท็บเล็ต (iOS 14+ / Android 8+)
- API ฝั่ง Backend ที่พัฒนาใน TypeScript (Auth, Meetings, Documents, Users)
- โครงสร้างพื้นฐานบน AWS (RDS PostgreSQL, S3 + CloudFront, WAF, CI/CD, เครือข่าย)
- แผงควบคุมผู้ดูแลระบบ (Admin panel – Next.js)
- Firebase (การแจ้งเตือน/การวิเคราะห์)

### บทบาทและความรับผิดชอบ (Roles & Responsibilities)
- **Titan AI:** เข้าถึงสภาพแวดล้อม, อนุมัติ, และเป็นเจ้าของการแก้ไขปัญหา
- **ThoughtWorks:** ดำเนินการตรวจสอบ, จัดทำรายงาน, และตรวจสอบซ้ำ (retest)
- **ร่วมกัน:** การยอมรับความเสี่ยง, การกำหนดเวลาสำหรับเปลี่ยนแปลง

### กำหนดการ (Schedule – สอดคล้องกับ Milestone ในใบเสนอราคา)
- สัปดาห์ที่ 1–3: ตรวจสอบความพร้อมด้านความปลอดภัยและการปฏิบัติตามกฎหมาย
- สัปดาห์ที่ 4–10: สแกนต่อเนื่อง, ทดสอบเจาะระบบเบื้องต้น, วัดค่าประสิทธิภาพพื้นฐาน
- สัปดาห์ที่ 11–16: ตรวจสอบรอบสุดท้าย, ตรวจสอบการแก้ไข, ลงนามอนุมัติ

---

## 1) การตรวจสอบด้านความปลอดภัย (Security Audit)

#### ขอบเขต (Scope)
- ช่องทางโจมตีจากภายนอกและภายในของ API, เว็บ Admin, และแอปมือถือ
- การกำหนดค่าคลาวด์ (IAM, network, storage, WAF) และความปลอดภัยของ CI/CD
- การอัปเดตแพตช์ของระบบปฏิบัติการและไลบรารี

#### กิจกรรม (Activities)
- การสแกนหาช่องโหว่: สแกนเซิร์ฟเวอร์, API, แอปมือถือ
- ตรวจสอบแพตช์: OS, DB, runtime, และ dependency
- การทดสอบเจาะระบบ: แบบ black-box/grey-box ครอบคลุม OWASP Top 10 (Web/Mobile/API)
- ตรวจสอบสิทธิ์การเข้าถึง: Least privilege สำหรับ IAM, DB และบทบาทในแอป

#### วิธีการและเครื่องมือ (Methods & Tools)
- เว็บ/API: OWASP ZAP หรือ Burp Suite; Postman/Newman สำหรับ workflow ของ API
- มือถือ: MobSF (วิเคราะห์ static/dynamic), ตรวจสอบ Play Integrity/App Transport Security
- Dependencies/Containers: Snyk/Trivy; npm/yarn audit; Gradle/Cocoapods
- คลาวด์: AWS IAM Access Analyzer, Trusted Advisor, Security Hub, GuardDuty

#### หลักฐานที่ต้องเก็บ (Evidence to Collect)
- รายงานสแกน, ผลการทดสอบเจาะระบบ, payload PoC (ลบข้อมูลสำคัญแล้ว)
- Diff ของ IAM policy, ตาราง least-privilege, ruleset ของ WAF
- รายงานแพตช์ (OS, DB, runtime, libraries)

#### เกณฑ์การยอมรับ (Acceptance Criteria)
- ไม่มีช่องโหว่ระดับ **Critical** คงค้าง; ระดับ **High** ได้รับการแก้ไขหรือมีวิธีชดเชย
- ไม่มีช่องโหว่ที่ทราบว่าสามารถโจมตีได้บนระบบที่เปิดสู่ภายนอก
- บังคับใช้ MFA สำหรับสิทธิ์พิเศษ; หมุนเวียนรหัสลับ; ไม่มีการ hardcode

---

## 2) การตรวจสอบด้านการปฏิบัติตามกฎหมาย (Compliance Audit)

#### มาตรฐานที่เกี่ยวข้อง (Applicable Standards)
- PDPA (พระราชบัญญัติคุ้มครองข้อมูลส่วนบุคคล)
- ETA (พระราชบัญญัติธุรกรรมทางอิเล็กทรอนิกส์)
- พระราชบัญญัติความมั่นคงปลอดภัยไซเบอร์ สำหรับงานของภาครัฐ

#### การควบคุม PDPA (PDPA Controls – ตัวอย่าง)
- บันทึกฐานทางกฎหมาย; การขอความยินยอม (ถ้ามี) ต้องตรวจสอบได้
- การลดปริมาณข้อมูล (minimization) สำหรับเลขบัตรประชาชน, biometric, ลายเซ็น
- สิทธิของเจ้าของข้อมูล: ขอเข้าถึง, แก้ไข, ลบ, คัดค้าน ได้จริง
- มาตรการความปลอดภัย: เข้ารหัสขณะส่ง (TLS 1.2+), ขณะเก็บ (RDS, S3 SSE)
- การเก็บรักษาและการลบ: มีนโยบาย, Scheduler, และบันทึกการลบตรวจสอบได้
- นิยามบทบาทผู้ประมวลผล/ผู้ควบคุมข้อมูล; บันทึกรายการประมวลผล (RoPA)

#### ความเชื่อถือได้ของลายเซ็นอิเล็กทรอนิกส์ตาม ETA
- ลายเซ็นต้องผูกกับตัวตนของผู้เซ็นและไม่ถูกเปลี่ยนแปลง
- การประทับเวลา (time-stamp) จากแหล่งเวลาที่ปลอดภัย (NTP, CloudWatch)
- ความสมบูรณ์ของเอกสาร: เก็บ hash ของเอกสารที่เซ็นและตรวจสอบเมื่อเปิดใช้
- เหตุการณ์การเซ็นถูกบันทึกใน audit trail ที่ไม่สามารถแก้ไขได้

#### การสอดคล้องกับพระราชบัญญัติความมั่นคงปลอดภัยไซเบอร์
- การจัดการบัญชีและสิทธิ์: least privilege, MFA, key rotation
- การป้องกันเครือข่าย: WAF, security group, subnet ส่วนตัวสำหรับ data store
- การเฝ้าระวัง: Security Hub, GuardDuty, CloudTrail, log รวมศูนย์
- การสำรองและกู้คืน: RDS backup อัตโนมัติ, ทดสอบการกู้คืนแล้ว

#### หลักฐานที่ต้องเก็บ
- นโยบาย (Privacy, Retention), RoPA, DPA, DPIA (ถ้ามี)
- การตั้งค่าการจัดการกุญแจ (KMS), การเข้ารหัส, ผลการทดสอบ TLS
- Log การตรวจสอบลายเซ็น, บันทึก hash match, หลักฐานการประทับเวลา

#### เกณฑ์การยอมรับ
- ไม่มีช่องว่างสำคัญด้าน PDPA; สิทธิของเจ้าของข้อมูลทำงานได้จริง
- ความเชื่อถือได้ของลายเซ็น ETA ตรวจสอบได้
- พระราชบัญญัติความมั่นคงไซเบอร์ ครอบคลุมขั้นต่ำครบถ้วน

---

## 3) การตรวจสอบประสิทธิภาพระบบ (System Performance Audit)

#### SLO เป้าหมาย (Target SLOs – จากใบเสนอราคา)
- โหลดเอกสาร: < 3 วินาที (P95)
- การลงลายเซ็นและส่ง: < 1 วินาที (P95)

#### กิจกรรม
- ทดสอบโหลดเซิร์ฟเวอร์: จำลองการใช้งานพร้อมกัน (เช่น การประชุมสภา)
- การปรับปรุงฐานข้อมูล: Index, วิเคราะห์ query ช้า, Connection pooling
- ประสิทธิภาพแอป: cold/warm start, การทำงานออฟไลน์, เอกสารขนาดใหญ่

#### วิธีการและเครื่องมือ
- Load test: k6 หรือ JMeter ตาม journey หลัก
- DB: pg_stat_statements, EXPLAIN ANALYZE, RDS Performance Insights
- แอป: Flutter DevTools, profiling; เว็บ Admin ใช้ Lighthouse

#### หลักฐานที่ต้องเก็บ
- แผนการทดสอบ, dataset, script, สเปกสภาพแวดล้อม, log
- Dashboard, query plan, metric ก่อน/หลัง

#### เกณฑ์การยอมรับ
- บรรลุ SLO ที่กำหนดพร้อม headroom 20%
- API latency P95 ไม่เกินเป้าหมายในโหลดต่อเนื่อง 30 นาที
- error rate ไม่เกิน 1%; มีการจัดการกรณี degrade

---

## 4) การตรวจสอบบันทึกการทำงาน (Audit Trail Review)

#### ขอบเขต
- การกระทำสำคัญทั้งหมด: login, การอนุมัติ/ปฏิเสธ, การเซ็น, การเปลี่ยนบทบาท, วงจรชีวิตเอกสาร

#### การควบคุม
- ความสมบูรณ์ของ log: append-only, ป้องกันการแก้ไข (hash-chain หรือ WORM)
- การติดตามย้อนกลับ: ใคร, ทำอะไร, เมื่อไร, ที่ไหน (IP/Device), context
- การซิงก์เวลา: ใช้ UTC เดียวกัน, ตรวจสอบ drift
- การเก็บรักษาและสิทธิ์การเข้าถึง: RBAC, retention policy

#### วิธีการและเครื่องมือ
- Logging รวมศูนย์: CloudWatch Logs, CloudTrail, S3 + Object Lock
- Integrity: ตรวจสอบ hash เป็นระยะ หรือ ledger table แบบ hash chain
- การแจ้งเตือน: กิจกรรม admin ผิดปกติ, เซ็นล้มเหลว, ดาวน์โหลด bulk

#### หลักฐานที่ต้องเก็บ
- ตัวอย่าง log ของแต่ละกิจกรรมสำคัญ พร้อม correlation ID
- รายงานตรวจสอบความสมบูรณ์ (hash verification, ledger reconciliation)

#### เกณฑ์การยอมรับ
- มี audit trail ที่สมบูรณ์, ป้องกันแก้ไข และค้นหาได้
- การตรวจสอบความสมบูรณ์สำเร็จในช่วงเวลาที่สุ่ม

---

## รายงานและสิ่งที่จะส่งมอบ (Reporting & Deliverables)
- รายงานสำหรับผู้บริหาร: สรุปข้อค้นพบ, ระดับความเสี่ยง, แผนการแก้ไข
- ภาคผนวกทางเทคนิค: ผลการสแกน, script, config, หลักฐาน
- Compliance matrix: PDPA/ETA/พระราชบัญญัติไซเบอร์ → มาตรการที่มี
- บันทึกการลงนาม: ยอมรับการแก้ไขและความเสี่ยงที่เหลืออยู่

## การแก้ไขและการทดสอบซ้ำ (Remediation & Re-Test)
- **Critical:** ต้องแก้ก่อน go-live; ตรวจสอบซ้ำ
- **High:** แก้ก่อน go-live หรือมีวิธีชดเชย + ยอมรับความเสี่ยง
- **Medium/Low:** แก้หลังเปิดใช้งาน พร้อมเจ้าของและกำหนดเวลา

## การจัดการข้อมูลและความลับ (Data Handling & Confidentiality)
- จัดชั้นข้อมูลทั้งหมดเป็น **Confidential**; เก็บใน repo/bucket ที่ปลอดภัย
- Log และ dataset ที่อ่อนไหวต้องลดหรือปิดบัง; แชร์ผ่านช่องทางที่อนุมัติ

---

## เช็กลิสต์ (Checklists – แบบย่อ)

### Security
- [ ] Endpoints ที่เปิดสู่ภายนอกถูกสแกน; ไม่มี Critical; High ถูกแก้
- [ ] MFA สำหรับบัญชีสิทธิ์พิเศษ; บังคับ least privilege
- [ ] จัดการ secrets ถูกต้อง; มีการหมุนเวียน
- [ ] WAF rules ทำงาน; มี alert anomaly

### Compliance
- [ ] Workflow สิทธิ PDPA ใช้งานได้จริง; retention job ทำงาน
- [ ] ตรวจสอบ hash/ลิงก์/timestamp ของลายเซ็น ETA
- [ ] Encryption at rest/in transit ถูกต้อง; KMS policy ตรวจสอบแล้ว

### Performance
- [ ] Load test ผ่าน SLO + headroom 20%
- [ ] Query DB ช้าได้รับการ optimize; index ตรวจสอบแล้ว
- [ ] App P95 ตรงตามเป้าบนอุปกรณ์ที่รองรับ

### Audit Trail
- [ ] Log เก็บแบบ immutable/hash-chain แล้ว
- [ ] ครอบคลุมกิจกรรมสำคัญทุกประเภท
- [ ] Time sync และ correlation log ยืนยันแล้ว

---

## ภาคผนวก A: สถานการณ์ทดสอบตัวอย่าง (Sample Test Scenarios)
- นายกเทศมนตรีอนุมัติวาระที่มีเอกสารแนบจำนวนมาก (โหลดสูงสุด)
- สมาชิกสภาส่งคำตอบพร้อมกัน (read/write contention)
- การเข้าถึงเอกสารแบบออฟไลน์และ sync ภายหลัง (500MB ต่อผู้ใช้)
- การเซ็นภายใต้เครือข่ายอ่อนแอ; ตรวจสอบ integrity หลังอัปโหลด

## ภาคผนวก B: โครงร่างรายงาน (Report Template – Outline)
1. สรุปสำหรับผู้บริหาร (Executive Summary)
2. ขอบเขตและวิธีการ (Scope and Methodology)
3. ข้อค้นพบและระดับความเสี่ยง (Findings and Risk Ratings)
4. Compliance Matrix (PDPA/ETA/พระราชบัญญัติไซเบอร์)
5. ผลลัพธ์ด้านประสิทธิภาพและการปฏิบัติตาม SLO
6. ผลการตรวจสอบ Audit Trail
7. แผนการแก้ไขและเจ้าของงาน (Remediation Plan and Owners)
8. การลงนามอนุมัติ (Sign-off)
