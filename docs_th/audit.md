## แผนการตรวจสอบ (Audit Plan) และรายการตรวจสอบ (Checklist)

อ้างอิง: `docs/quotation.md`

### วัตถุประสงค์
กำหนดแนวทางการตรวจสอบ ขอบเขต เกณฑ์การยอมรับ ข้อกำหนดด้านหลักฐาน และการรายงานสำหรับด้านความปลอดภัย การปฏิบัติตามข้อกำหนด ประสิทธิภาพ และบันทึกการตรวจสอบย้อนกลับ ให้สอดคล้องกับโครงการระบบบริหารการประชุมของหน่วยงานภาครัฐ

### เป้าหมาย
- ตรวจสอบท่าทีด้านความปลอดภัยและลดความเสี่ยงเชิงรุก
- แสดงการปฏิบัติตามกฎหมาย (PDPA, ETA, พระราชบัญญัติความมั่นคงปลอดภัยไซเบอร์)
- ยืนยันว่าประสิทธิภาพระบบเป็นไปตาม SLO ที่ผู้ใช้คาดหวัง (เอกสาร < 3 วินาที; ลายเซ็น < 1 วินาที)
- ทำให้สามารถตรวจสอบการกระทำสำคัญได้และตรวจพบการแก้ไข (การอนุมัติ การลงลายมือชื่อ)

### ระบบที่อยู่ในขอบเขต
- แอปแท็บเล็ต Flutter (iOS 14+ / Android 8+)
- API ฝั่งเซิร์ฟเวอร์ด้วย TypeScript (Auth, Meetings, Documents, Users)
- โครงสร้างพื้นฐาน AWS (RDS PostgreSQL, S3 + CloudFront, WAF, CI/CD, เครือข่าย)
- แผงผู้ดูแลระบบ (Next.js)
- Firebase (การแจ้งเตือน/การวิเคราะห์)

### บทบาทและความรับผิดชอบ
- Titan AI: การเข้าถึงสภาพแวดล้อม การอนุมัติ ความเป็นเจ้าของในการแก้ไข
- ThoughtWorks: การดำเนินการตรวจสอบ การรายงาน การยืนยันผลการทดสอบซ้ำ
- ร่วมกัน: การยอมรับความเสี่ยง การจัดตารางช่วงเวลาการเปลี่ยนแปลง

### กำหนดการ (สอดคล้องกับหมุดหมายในใบเสนอราคา)
- สัปดาห์ที่ 1–3: ทบทวนความพร้อมด้านความปลอดภัยและการปฏิบัติตามข้อกำหนดขั้นพื้นฐาน
- สัปดาห์ที่ 4–10: สแกนอย่างต่อเนื่อง ทดสอบการเจาะระบบระหว่างทาง ตั้งค่าค่ามาตรฐานด้านประสิทธิภาพ
- สัปดาห์ที่ 11–16: การตรวจสอบรอบสุดท้าย การยืนยันการแก้ไข การลงนามยืนยัน

---

## 1) การตรวจสอบความปลอดภัย (Security Audit)

#### ขอบเขต
- พื้นที่ผิวการโจมตีภายนอกและภายในสำหรับ API เว็บแอดมิน และแอปมือถือ
- การตั้งค่าคลาวด์ (IAM เครือข่าย ที่เก็บข้อมูล WAF) และความปลอดภัยของ CI/CD
- ระดับแพตช์ของส่วนพึ่งพา (dependencies) และระบบปฏิบัติการ

#### กิจกรรม
- สแกนช่องโหว่: สแกนอัตโนมัติของเซิร์ฟเวอร์ API และแอปมือถือ
- ตรวจสอบแพตช์: อัปเดต OS ฐานข้อมูล รันไทม์ และส่วนพึ่งพา
- ทดสอบการเจาะระบบ: ทดสอบแบบ black/grey-box ครอบคลุม OWASP Top 10 (Web/Mobile/API)
- ทบทวนการควบคุมการเข้าถึง: ใช้หลักการสิทธิ์น้อยที่สุดสำหรับ IAM ฐานข้อมูล และบทบาทของแอปพลิเคชัน

#### วิธีการและเครื่องมือ
- เว็บ/API: OWASP ZAP หรือ Burp Suite; Postman/Newman สำหรับเวิร์กโฟลว์ API
- มือถือ: MobSF วิเคราะห์แบบสแตติก/ไดนามิก; ตรวจสอบ Play Integrity/App Transport Security
- ส่วนพึ่งพา/คอนเทนเนอร์: Snyk/Trivy; npm/yarn audit; ตรวจสอบ Gradle และ CocoaPods
- คลาวด์: AWS IAM Access Analyzer, Trusted Advisor, Security Hub, GuardDuty

#### หลักฐานที่ต้องรวบรวม
- รายงานการสแกน ผลการทดสอบเจาะระบบ ชุด payload พิสูจน์แนวคิด (ทำความสะอาดข้อมูลอ่อนไหว)
- ความแตกต่างของนโยบาย IAM เมทริกซ์สิทธิ์แบบ least-privilege ชุดกฎ WAF
- รายงานระดับแพตช์ (OS ฐานข้อมูล รันไทม์ ไลบรารี)

#### เกณฑ์การยอมรับ
- ไม่มีข้อค้นพบระดับวิกฤตที่ยังเปิดอยู่; ข้อค้นพบระดับสูงถูกแก้ไขแล้วหรือมีมาตรการชดเชยที่ได้รับอนุมัติ
- 0 ช่องโหว่ที่ทราบว่าสามารถโจมตีได้บนทรัพยากรที่เปิดสู่สาธารณะ
- บังคับใช้ MFA สำหรับการเข้าถึงที่มีสิทธิ์สูงทั้งหมด; หมุนเวียนความลับ; ไม่มีความลับฮาร์ดโค้ด

---

## 2) การตรวจสอบการปฏิบัติตามข้อกำหนด (Compliance Audit)

#### มาตรฐานที่เกี่ยวข้อง
- PDPA (พระราชบัญญัติคุ้มครองข้อมูลส่วนบุคคล)
- ETA (พระราชบัญญัติว่าด้วยธุรกรรมทางอิเล็กทรอนิกส์)
- มาตรฐานขั้นต่ำตามพระราชบัญญัติความมั่นคงปลอดภัยไซเบอร์สำหรับงานภาครัฐ

#### การควบคุมตาม PDPA (ตัวอย่าง)
- บันทึกฐานกฎหมาย; เก็บและตรวจสอบได้ซึ่งความยินยอม (หากใช้)
- ลดปริมาณข้อมูลสำหรับเลขบัตรประชาชน ไบโอเมตริกซ์ ลายเซ็น; จำกัดตามวัตถุประสงค์
- สิทธิของเจ้าของข้อมูล: กระบวนการขอเข้าถึง แก้ไข ลบ คัดค้าน
- มาตรการความปลอดภัย: การเข้ารหัสระหว่างส่งผ่าน (TLS 1.2+) และขณะพัก (RDS, S3 SSE)
- การเก็บรักษาและการลบ: นโยบาย ตัวตั้งเวลา และบันทึกการลบที่ตรวจสอบได้
- กำหนดบทบาทผู้ประมวลผล/ผู้ควบคุม; บันทึกกิจกรรมการประมวลผล (RoPA)

#### ความเชื่อถือได้ของลายมือชื่ออิเล็กทรอนิกส์ตาม ETA
- ลายมือชื่อเชื่อมโยงกับตัวตนผู้ลงนามและได้รับการป้องกันการแก้ไข
- ประทับเวลาโดยใช้แหล่งเวลาที่ปลอดภัยและซิงก์กัน (NTP, CloudWatch)
- ความถูกต้องของเอกสาร: จัดเก็บแฮชของข้อมูลที่ลงลายมือชื่อและตรวจสอบเมื่อเรียกดู
- บันทึกเหตุการณ์ลงลายมือชื่อในบันทึกตรวจสอบย้อนกลับแบบแก้ไขย้อนหลังไม่ได้ พร้อมบริบทของผู้ลงนาม

#### การสอดคล้องกับพระราชบัญญัติความมั่นคงปลอดภัยไซเบอร์
- การจัดการบัญชีและการเข้าถึง: สิทธิ์น้อยที่สุด, MFA, การหมุนเวียนกุญแจ
- การป้องกันเครือข่าย: WAF, security group, ซับเน็ตส่วนตัวสำหรับที่เก็บข้อมูล
- การติดตาม: Security Hub, GuardDuty, CloudTrail, บันทึกแบบรวมศูนย์
- การสำรองและกู้คืน: สำรองอัตโนมัติของ RDS และทดสอบขั้นตอนการกู้คืน

#### หลักฐานที่ต้องรวบรวม
- นโยบาย (ความเป็นส่วนตัว การเก็บรักษา) RoPA DPA DPIA (ถ้ามี)
- การตั้งค่าการจัดการกุญแจ การตั้งค่าการเข้ารหัส ผลการทดสอบ TLS
- บันทึกการตรวจสอบลายมือชื่อ ผลการเทียบแฮช หลักฐานการประทับเวลา

#### เกณฑ์การยอมรับ
- ไม่มีช่องว่างด้าน PDPA ที่มีนัยสำคัญ; สามารถสาธิตกระบวนการสิทธิของเจ้าของข้อมูลครบวงจร
- เป็นไปตามข้อกำหนดความเชื่อถือได้ของลายมือชื่อ ETA อย่างชัดเจน
- บรรลุมาตรฐานขั้นต่ำตามพระราชบัญญัติความมั่นคงปลอดภัยไซเบอร์พร้อมเอกสารกำกับ

---

## 3) การตรวจสอบประสิทธิภาพระบบ (System Performance Audit)

#### SLO เป้าหมาย (จากใบเสนอราคา)
- เวลาโหลดเอกสาร: < 3 วินาที (P95)
- การจับและส่งลายเซ็น: < 1 วินาที (P95)

#### กิจกรรม
- ทดสอบโหลดฝั่งเซิร์ฟเวอร์: การใช้งานพร้อมกันระดับสูง (เช่น สถานการณ์การประชุมสภา)
- ปรับแต่งฐานข้อมูล: ดัชนี การวิเคราะห์คิวรีช้า การจัดการพูลการเชื่อมต่อ
- ประสิทธิภาพแอป: การเริ่มแบบ cold/warm พฤติกรรมแคชออฟไลน์ การจัดการเอกสารขนาดใหญ่

#### วิธีการและเครื่องมือ
- โหลด: k6 หรือ JMeter สคริปต์ตามเส้นทางการใช้งานหลักของผู้ใช้
- ฐานข้อมูล: pg_stat_statements, EXPLAIN ANALYZE, RDS Performance Insights
- แอป: Flutter DevTools โปรไฟลิง; เว็บแอดมินใช้ Lighthouse

#### หลักฐานที่ต้องรวบรวม
- แผนการทดสอบ ชุดข้อมูล และสคริปต์; สเปกสภาพแวดล้อม; บันทึกการรัน
- แดชบอร์ดประสิทธิภาพ แผนคิวรี เมตริกก่อน/หลัง

#### เกณฑ์การยอมรับ
- เป็นไปตามหรือดีกว่า SLO ที่ความหนาแน่นผู้ใช้สูงสุดที่คาดการณ์ (มีส่วนเผื่อ 20%)
- ไม่มีค่า latency ของ API ระดับ P95 เกินเกณฑ์เป้าหมายระหว่างโหลดต่อเนื่อง 30 นาที
- ไม่มีอัตราความผิดพลาดพุ่งเกิน 1% ระหว่างทดสอบ; มีเอกสารการเสื่อมประสิทธิภาพอย่างสง่างาม

---

## 4) ทบทวนบันทึกการตรวจสอบย้อนกลับ (Audit Trail Review)

#### ขอบเขต
- การกระทำสำคัญทั้งหมด: การเข้าสู่ระบบ การอนุมัติ การปฏิเสธ เหตุการณ์ลายเซ็น การเปลี่ยนบทบาท เหตุการณ์วงจรชีวิตเอกสาร

#### การควบคุม
- ความสมบูรณ์ของบันทึก: เพิ่มได้อย่างเดียว ตรวจพบการแก้ไข (ผูกแฮชเป็นสายโซ่หรือเก็บแบบ WORM)
- การติดตามย้อนกลับ: ใคร ทำอะไร เมื่อ ที่ไหน (IP/อุปกรณ์) และบริบท
- การซิงโครไนซ์เวลา: ใช้เวลา UTC อย่างสอดคล้อง ตรวจสอบการคลาดเคลื่อน
- การเก็บรักษาและการเข้าถึง: การเข้าถึงบันทึกตามบทบาทและใช้นโยบายการเก็บรักษา

#### วิธีการและเครื่องมือ
- การบันทึกแบบรวมศูนย์: CloudWatch Logs, CloudTrail, ตัวเลือก S3 + Object Lock (WORM)
- ความถูกต้อง: ตรวจสอบแฮชเป็นระยะหรือใช้ตารางบัญชีแยกประเภท (ledger) ที่มีโซ่แฮช
- การแจ้งเตือน: ความผิดปกติของการกระทำผู้ดูแล ลายเซ็นล้มเหลว การดาวน์โหลดจำนวนมาก

#### หลักฐานที่ต้องรวบรวม
- ตัวอย่างช่วงบันทึกสำหรับแต่ละการกระทำสำคัญพร้อมรหัสเชื่อมโยง (correlation ID)
- รายงานการตรวจสอบความถูกต้องของความสมบูรณ์หรือผลการกระทบยอดบัญชีแยกประเภท

#### เกณฑ์การยอมรับ
- มีบันทึกตรวจสอบย้อนกลับที่ครบถ้วน ไม่สามารถแก้ไขย้อนหลัง และสืบค้นได้ ครอบคลุมทุกการกระทำสำคัญ
- การตรวจสอบความถูกต้องของความสมบูรณ์ผ่านช่วงเวลาที่สุ่มตัวอย่างสำเร็จ

---

## การรายงานและผลส่งมอบ
- รายงานผู้บริหาร: สรุปข้อค้นพบ การจัดระดับความเสี่ยง และแผนการแก้ไข
- ภาคผนวกทางเทคนิค: เอาต์พุตการสแกน สคริปต์ทดสอบ การตั้งค่า และหลักฐาน
- เมทริกซ์การปฏิบัติตามข้อกำหนด: การแม็ป PDPA/ETA/พระราชบัญญัติความมั่นคงปลอดภัยไซเบอร์ เข้ากับการควบคุมที่นำไปใช้
- บันทึกลงนาม: การยอมรับการแก้ไขและความเสี่ยงที่เหลือ (ถ้ามี)

## การแก้ไขและการทดสอบซ้ำ
- ระดับวิกฤต: แก้ก่อนเปิดใช้งานจริง; ต้องทดสอบซ้ำ
- ระดับสูง: แก้ก่อนเปิดใช้งานจริง หรือมีมาตรการชดเชยที่ได้รับการยอมรับอย่างชัดแจ้ง
- ระดับกลาง/ต่ำ: กำหนดหลังเปิดใช้งาน พร้อมระบุผู้รับผิดชอบและกำหนดเวลา

## การจัดการข้อมูลและการรักษาความลับ
- จัดประเภทสิ่งประดิษฐ์ทั้งหมดเป็นความลับ (Confidential); จัดเก็บในที่เก็บ/บัคเก็ตที่ปลอดภัย
- ลดหรือปกปิดข้อมูลอ่อนไหวในบันทึกและชุดข้อมูล; แชร์ผ่านช่องทางที่ได้รับอนุมัติ

---

## รายการตรวจสอบ (ฉบับย่อ)

### ความปลอดภัย
- [ ] สแกนปลายทางที่เปิดสู่สาธารณะ; ไม่มีระดับวิกฤต; ระดับสูงได้รับการจัดการ
- [ ] MFA สำหรับบัญชีที่มีสิทธิ์สูง; บังคับใช้สิทธิ์น้อยที่สุด
- [ ] จัดการความลับ (ไม่มีการฮาร์ดโค้ด); ตรวจสอบการหมุนเวียน
- [ ] เปิดใช้งานกฎ WAF; ตั้งค่าการแจ้งเตือนความผิดปกติ

### การปฏิบัติตามข้อกำหนด
- [ ] สามารถสาธิตเวิร์กโฟลว์สิทธิ PDPA; มีงานกำหนดเวลาการเก็บรักษา
- [ ] ตรวจสอบแฮชลายเซ็น ความเชื่อมโยง และการประทับเวลาแล้ว
- [ ] ตรวจสอบการเข้ารหัสขณะพัก/ระหว่างส่งแล้ว; ทบทวนนโยบาย KMS

### ประสิทธิภาพ
- [ ] การทดสอบโหลดบรรลุ SLO โดยมีส่วนเผื่อ 20%
- [ ] ปรับแต่งคิวรีช้าของฐานข้อมูล; ตรวจสอบดัชนีแล้ว
- [ ] ค่าเมตริก P95 ของแอปอยู่ภายในเป้าหมายบนอุปกรณ์ที่รองรับ

### บันทึกการตรวจสอบย้อนกลับ
- [ ] ใช้ที่เก็บบันทึกแบบแก้ไขย้อนหลังไม่ได้ หรือโซ่แฮช
- [ ] ตรวจสอบความครอบคลุมของการกระทำสำคัญทั้งหมดแล้ว
- [ ] ยืนยันการซิงค์เวลาและการเชื่อมโยงบันทึกแล้ว

---

## ภาคผนวก ก: สถานการณ์ทดสอบตัวอย่าง
- นายกเทศมนตรีอนุมัติระเบียบวาระขนาดใหญ่พร้อมไฟล์แนบ (ความหนาแน่นสูงสุด)
- สมาชิกสภาส่งคำตอบพร้อมกัน (การแข่งขันอ่าน/เขียน)
- เข้าถึงเอกสารแบบออฟไลน์และซิงก์ภายหลัง โดยมีแคช 500MB ต่อผู้ใช้
- จับลายเซ็นภายใต้เครือข่ายเสื่อมคุณภาพ; ตรวจสอบความถูกต้องเมื่ออัปโหลด

## ภาคผนวก ข: แม่แบบรายงาน (โครงร่าง)
1. สรุปสำหรับผู้บริหาร
2. ขอบเขตและระเบียบวิธี
3. ข้อค้นพบและการจัดระดับความเสี่ยง
4. เมทริกซ์การปฏิบัติตามข้อกำหนด (PDPA/ETA/พระราชบัญญัติความมั่นคงปลอดภัยไซเบอร์)
5. ผลการทดสอบประสิทธิภาพและการเป็นไปตาม SLO
6. ผลการตรวจสอบความถูกต้องของบันทึกตรวจสอบย้อนกลับ
7. แผนการแก้ไขและผู้รับผิดชอบ
8. ลงนามยืนยัน
